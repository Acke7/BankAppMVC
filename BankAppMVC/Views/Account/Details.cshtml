@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}


@{
    ViewBag.Title = "Account Details";
}
@model List<BankAppMVC.Models.ViewModels.AccountTransactionsViewModel>

<main class="main px-lg-6">
    <div class="container-lg">
        <div class="row mb-8">
            <div class="col-12 col-md-6 col-xxl-3 mb-4 mb-xxl-0">
                <div class="card bg-body-tertiary border-transparent">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col">
                                <!-- Heading -->
                                <h4 class="fs-sm fw-normal text-body-secondary mb-1">Balance</h4>

                                <!-- Text -->
                                <div class="fs-4 fw-semibold">  @Model.FirstOrDefault()?.AccountBalance.ToString("C")</div>
                            </div>
                            <div class="col-auto">
                                <!-- Avatar -->
                                <div class="avatar avatar-lg bg-body text-primary">
                                    <i class="bi bi-cash-coin"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-xxl-3 mb-4 mb-xxl-0">
                <div class="card bg-body-tertiary border-transparent">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col">
                                <!-- Heading -->
                                <h4 class="fs-sm fw-normal text-body-secondary mb-1">Account Number</h4>

                                <!-- Text -->
                                <div class="fs-4 fw-semibold"> @Model.FirstOrDefault()?.AccountNumber</div>
                            </div>
                            <div class="col-auto">
                                <!-- Avatar -->
                                <div class="avatar avatar-lg bg-body text-primary">
                                    <i class="bi bi-credit-card"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-xxl-3 mb-4 mb-md-0">
                <div class="card bg-body-tertiary border-transparent">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col">
                                <!-- Heading -->
                                <h4 class="fs-sm fw-normal text-body-secondary mb-1">Avg. time</h4>

                                <!-- Text -->
                                <div class="fs-4 fw-semibold">2:55 hrs</div>
                            </div>
                            <div class="col-auto">
                                <!-- Avatar -->
                                <div class="avatar avatar-lg bg-body text-primary">
                                    <i class="fs-4" data-duoicon="slideshow"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-xxl-3">
                <div class="card bg-body-tertiary border-transparent">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col">
                                <!-- Heading -->
                                <h4 class="fs-sm fw-normal text-body-secondary mb-1">Weekly growth</h4>

                                <!-- Text -->
                                <div class="fs-4 fw-semibold">14.5%</div>
                            </div>
                            <div class="col-auto">
                                <!-- Avatar -->
                                <div class="avatar avatar-lg bg-body text-primary">
                                    <i class="fs-4" data-duoicon="discount"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-responsive mb-7">
            <table class="table table-selectable align-middle mb-0">
                <thead>
                    <tr>
                        <th style="width: 0px">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="tableCheckAll" />
                                <label class="form-check-label" for="tableCheckAll"></label>
                            </div>
                        </th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Operation</th>
                        <th>Amount</th>
                        <th>Balance</th>
                        <th>Symbol</th>
                        <th>Bank</th>
                        <th>Account</th>
                    </tr>
                </thead>
                <tbody id="transaction-body">
                    @foreach (var transaction in Model.Take(20))
                    {
                        <tr>
                            <td style="width: 0px">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" />
                                    <label class="form-check-label"></label>
                                </div>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="ms-4">
                                        <div>@transaction.Date.ToShortDateString()</div>
                                    </div>
                                </div>
                            </td>
                            <td>@transaction.Type</td>
                            <td>@transaction.Operation</td>
                            <td>@transaction.Amount.ToString("C")</td>
                            <td>@transaction.Balance.ToString("C")</td>
                            <td>@transaction.Symbol</td>
                            <td>@transaction.Bank</td>
                            <td>@transaction.Account</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <button id="loadMoreBtn" class="btn btn-secondary d-block"
                data-skip="20"
                data-AccountNumber="@ViewBag.AccountNumber">
            Load more
        </button>
    </div>
</main>

@section Scripts {
    <script>
        $('#loadMoreBtn').on('click', function () {
            var button = $(this);
            var skip = button.data('skip');
            var accountNumber = button.data('accountnumber'); // lowercase key used in HTML

            $.get('/Account/LoadMoreTransactions', { AccountNumber: accountNumber, skip: skip }, function (data) {
                if (data.trim() !== '') {
                    $('#transaction-body').append(data);
                    button.data('skip', skip + 20);
                } else {
                    button.hide(); // No more transactions
                }
            });
        });
    </script>
}
